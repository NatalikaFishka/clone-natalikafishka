!function(t){var e={};function s(o){if(e[o])return e[o].exports;var c=e[o]={i:o,l:!1,exports:{}};return t[o].call(c.exports,c,c.exports,s),c.l=!0,c.exports}s.m=t,s.c=e,s.d=function(t,e,o){s.o(t,e)||Object.defineProperty(t,e,{enumerable:!0,get:o})},s.r=function(t){"undefined"!=typeof Symbol&&Symbol.toStringTag&&Object.defineProperty(t,Symbol.toStringTag,{value:"Module"}),Object.defineProperty(t,"__esModule",{value:!0})},s.t=function(t,e){if(1&e&&(t=s(t)),8&e)return t;if(4&e&&"object"==typeof t&&t&&t.__esModule)return t;var o=Object.create(null);if(s.r(o),Object.defineProperty(o,"default",{enumerable:!0,value:t}),2&e&&"string"!=typeof t)for(var c in t)s.d(o,c,function(e){return t[e]}.bind(null,c));return o},s.n=function(t){var e=t&&t.__esModule?function(){return t.default}:function(){return t};return s.d(e,"a",e),e},s.o=function(t,e){return Object.prototype.hasOwnProperty.call(t,e)},s.p="",s(s.s=0)}([function(t,e,s){"use strict";s.r(e);const o=new class{constructor(t,e){this.canvas=document.createElement("canvas"),this.tool="pencil",this.width=t,this.height=e,this.isDrawing=!1,this.ctx=this.canvas.getContext("2d"),this.selectedColor="rgba(128,128,128,1)",this.scaleX=1,this.scaleX=1}init(t){this.canvas.setAttribute("id","canvas"),this.canvas.setAttribute("width",this.width),this.canvas.setAttribute("height",this.height),document.querySelector(".canvases").appendChild(this.canvas),this._getFromLS(t),this._customPointer(),document.addEventListener("click",()=>this._saveToLS())}setColor(t){return this.selectedColor=t.target.value,this._saveToLS(),this.selectedColor}selectTool(t,e){this.tool=e.target.value,e.path.length>7&&null!==t.querySelector("input[checked]")&&t.querySelector("input[checked]").removeAttribute("checked"),e.target.setAttribute("checked",""),e.stopPropagation(),this._saveToLS()}toolBehavior(t){switch(this.tool){case"pencil":this.isDrawing=!0,this.pencilDraw(t);break;case"paint-bucket":this.floodFill(t.offsetX,t.offsetY,this.selectedColor);break;case"color-picker":this.pickColor(t)}}pencilDraw(t){if(!this.isDrawing)return;const e=Math.floor(t.offsetX/this.scaleX),s=Math.floor(t.offsetY/this.scaleY);this.ctx.fillStyle=this.selectedColor,this.ctx.fillRect(e*this.scaleX,s*this.scaleY,this.scaleX,this.scaleY)}pickColor(t){const e=this.ctx.getImageData(t.offsetX,t.offsetY,1,1).data;this.selectedColor=`rgba(${e[0]},${e[1]},${e[2]},${e[3]/255})`,document.getElementById("current-color").style.background=this.selectedColor}floodFill(t,e,s){const o=(t,e,s)=>{const o=Math.floor(e/this.scaleX);return t[4*Math.floor(s/this.scaleY)+o]},c=(t,e,s,o)=>{const c=t,i=Math.floor(e/this.scaleX),l=Math.floor(s/this.scaleY);return this.ctx.fillStyle=o,this.ctx.fillRect(i*this.scaleX,l*this.scaleY,this.scaleX,this.scaleY),c[4*l+i]=o,c},i=(t,e,s,l,a)=>{o(t,e,s)===l&&e>0&&s>0&&(c(t,e,s,a),i(t,e+this.scaleX,s,l,a),i(t,e-this.scaleX,s,l,a),i(t,e,s+this.scaleY,l,a),i(t,e,s-this.scaleY,l,a))},l=this._imageConverter(),a=o(l,t,e);a!==s&&i(l,t,e,a,s);const r=[],n=l;for(;n.length>0;)r.push(n.splice(0,4));this._setImage(r)}keyboardControl(t,e){if("KeyP"===e.code||"KeyC"===e.code||"KeyB"===e.code)switch(t.removeAttribute("checked"),e.code){case"KeyP":this.tool=document.getElementById("pencil").value,document.getElementById("pencil").setAttribute("checked","");break;case"KeyB":this.tool=document.getElementById("paint-bucket").value,document.getElementById("paint-bucket").setAttribute("checked","");break;case"KeyC":this.tool=document.getElementById("color-picker").value,document.getElementById("color-picker").setAttribute("checked","")}}_setImage(t){const e=t[0].length,s=t.length;this.scaleX=this.canvas.width/e,this.scaleY=this.canvas.height/s;for(let o=0;o<s;o+=1)for(let s=0;s<e;s+=1)this.ctx.fillStyle=t[o][s],this.ctx.fillRect(s*this.scaleX,o*this.scaleY,this.scaleX,this.scaleY)}_customPointer(){this.canvas.addEventListener("mouseover",()=>{switch(this.tool){case"pencil":this.canvas.style.cursor="url(../assets/cursors/pencil.png), default";break;case"paint-bucket":this.canvas.style.cursor="url(../assets/cursors/paint-bucket.png), default";break;case"color-picker":this.canvas.style.cursor="url(../assets/cursors/color-picker.png), default"}})}_saveToLS(){localStorage.setItem("canvas",this._imageConverter()),localStorage.setItem("color",this.selectedColor),localStorage.setItem("tool",this.tool)}_getFromLS(t){if(localStorage.getItem("canvas")){let t=localStorage.getItem("canvas");t=(t=(t=t.replace(/\)/gm,"))")).substr(0,t.length-1)).split("),");const e=[];for(;t.length>0;)e.push(t.splice(0,4));this._setImage(e)}else this._setImage(t);localStorage.getItem("tool")?(this.tool=localStorage.getItem("tool"),document.getElementById(this.tool).setAttribute("checked","")):(this.tool="pencil",document.getElementById(this.tool).setAttribute("checked","")),localStorage.getItem("color")?(this.selectedColor=localStorage.getItem("color"),document.getElementById("current-color").style.background=this.selectedColor):(this.selectedColor="rgba(128,128,128,1)",document.getElementById("current-color").style.background=this.selectedColor)}_imageConverter(){const t=this.ctx.getImageData(0,0,this.height,this.width).data,e=[],s=this.height*this.width*4;for(let o=0;o<s;o+=this.width*this.scaleY*4)for(let s=o;s<o+4*this.width;s+=4*this.scaleX)e.push(`rgba(${t[s+0]},${t[s+1]},${t[s+2]},${t[s+3]/255})`);return e}drawImageOnCanvas(t){const e=new Image;e.src=t;let s=1;e.onload=()=>{if(e.width>=e.height){s=e.width/this.width;for(let t=0;t<e.height;t+=this.scaleY*s)for(let o=0;o<e.width;o+=this.scaleX*s)this.ctx.drawImage(e,o,t,this.scaleX*s,this.scaleY*s,o/s,t/s+(this.height/2-e.height/(2*s)),this.scaleX,this.scaleY)}else{s=e.height/this.height;for(let t=0;t<e.height;t+=this.scaleY*s)for(let o=0;o<e.width;o+=this.scaleX*s)this.ctx.drawImage(e,o,t,this.scaleX*s,this.scaleY*s,o/s+(this.width/2-e.width/(2*s)),t/s,this.scaleX,this.scaleY)}}}}(512,512);o.init([["#FFFFFF","#FFFFFF","#FFFFFF","#FFFFFF"],["#FFFFFF","#FFFFFF","#FFFFFF","#FFFFFF"],["#FFFFFF","#FFFFFF","#FFFFFF","#FFFFFF"],["#FFFFFF","#FFFFFF","#FFFFFF","#FFFFFF"]]);const c=document.querySelector("canvas"),i=document.getElementById("current-color");document.getElementById("current-color-input").addEventListener("change",t=>{i.style.background=o.setColor(t)}),c.addEventListener("mousedown",t=>o.toolBehavior(t)),c.addEventListener("mousemove",t=>o.pencilDraw(t)),document.addEventListener("mouseup",()=>{o.isDrawing=!1});const l=document.querySelector(".tools");l.addEventListener("click",t=>o.selectTool(l,t)),document.addEventListener("keydown",t=>o.keyboardControl(l.querySelector("input[checked]"),t));const a=document.createElement("button");a.setAttribute("type","button"),a.innerText="Load",document.querySelector("main").appendChild(a),a.addEventListener("click",async()=>{let t=await async function(){let t=await fetch("https://api.unsplash.com/photos/random?query=town,Minsk&client_id=196b80d7ba2c92d42c480c466d9896b09909ffb5fc28847b1dcd980fb4b63e44"),e=await t.json();return await e.urls.small}();o.drawImageOnCanvas(t)})}]);